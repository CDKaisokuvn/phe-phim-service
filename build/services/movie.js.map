{"version":3,"sources":["../../src/services/movie.js"],"names":["updateMovieDetail","movie","request","get","link","response","cheerio","load","$","trailer","attr","description","text","categories","eq","split","slug_cats","times","views","trim","replace","year","country","actors","director","rating","rating_count","getListMovies","page","baseURL","list","each","i","e","title","find","subtitle","img","slice","push","getMovieSrc","puppeteer","launch","args","browser","newPage","console","log","waitUntil","evaluate","document","querySelector","getAttribute","src","save","close"],"mappings":"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","sourcesContent":["import request from \"request-promise\";\r\nimport cheerio from \"cheerio\";\r\nimport { slug } from \"../utils\";\r\nimport puppeteer from \"puppeteer\";\r\n\r\nexport async function updateMovieDetail(movie) {\r\n    const response = await request.get(movie.link);\r\n    const $ = await cheerio.load(response);\r\n    movie.trailer = $(\"iframe\").attr(\"src\");\r\n    movie.description = $(\"p.content-h\").text();\r\n    movie.categories = $(\".info-y li\").eq(-5).text().split(\":\")[1];\r\n    movie.slug_cats = (movie.categories && slug(movie.categories)) || \"\";\r\n    movie.times = $(\".info-y li\").eq(-3).text().split(\":\")[1];\r\n    movie.views =\r\n        +$(\".info-y li\")\r\n            .eq(-2)\r\n            .text()\r\n            .split(\":\")[1]\r\n            .trim()\r\n            .replace(\",\", \"\")\r\n            .replace(\"'\", \"\")\r\n            .replace('\"', \"\") || 0;\r\n    movie.year = $(\".info-y li\").eq(-1).text().split(\":\")[1];\r\n    movie.country = $(\".info-y li\").eq(-4).text().split(\":\")[1];\r\n    movie.actors = $(\".info-y li\").eq(-6).text().split(\":\")[1];\r\n    movie.director = $(\".info-y li\").eq(-7).text().split(\":\")[1];\r\n    movie.rating = +$(\"#average\").text().trim();\r\n\r\n    movie.rating_count = +$(\"#rate_count\").text().trim() || 0;\r\n    if (movie.link === $(\"a.btn-see.btn.btn-danger\").attr(\"href\")) {\r\n        return null;\r\n    } else {\r\n        movie.link = $(\"a.btn-see.btn.btn-danger\").attr(\"href\");\r\n        return movie;\r\n    }\r\n}\r\n\r\nexport async function getListMovies(page) {\r\n    const baseURL = `https://bilutvzz.net/phim-le//trang-${page}`;\r\n    const response = await request.get(baseURL);\r\n\r\n    const $ = await cheerio.load(response);\r\n    const list = [];\r\n    // eslint-disable-next-line no-unused-vars\r\n    $(\"li.film-item\").each(function (i, e) {\r\n        const title = $(this).find(\"p.name\").text();\r\n        const subtitle = $(this).find(\"p.real-name\").text();\r\n        const img = $(this).find(\".list-img\").attr(\"style\").slice(21, -2);\r\n        const link = $(this).find(\"a\").attr(\"href\");\r\n\r\n        list.push({ title, subtitle, img, link });\r\n    });\r\n    return list;\r\n}\r\n\r\nexport async function getMovieSrc(movie) {\r\n    const browser = await puppeteer.launch({ args: [\"--no-sandbox\"] });\r\n\r\n    const page = await browser.newPage();\r\n\r\n    console.log(\"Start\");\r\n    await page.goto(movie.link, {\r\n        waitUntil: \"networkidle2\",\r\n    });\r\n    movie.src = await page.evaluate(() => {\r\n        // eslint-disable-next-line no-undef\r\n        return document.querySelector(\"iframe\").getAttribute(\"src\");\r\n    });\r\n    await movie.save();\r\n    await browser.close();\r\n}\r\n"],"file":"movie.js"}