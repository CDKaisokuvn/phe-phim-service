{"version":3,"sources":["../../src/services/index.js"],"names":["crawlMovies","queue","kue","createQueue","redis","createClientFactory","Redis","env","uri","i","job","create","page","save","err","console","log","id","process","done","data","list","Promise","all","map","movie","list_updated","filter","e","Movie"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;SAEsBA,W;;;;;yEAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AACGC,YAAAA,KADH,GACWC,gBAAIC,WAAJ,CAAgB;AAC1BC,cAAAA,KAAK,EAAE;AACHC,gBAAAA,mBAAmB,EAAE,+BAAY;AAC7B,yBAAO,IAAIC,mBAAJ,EAAP;AACH;AAHE;AADmB,aAAhB,CADX;AAAA;AAAA,mBASG,wBAAUC,aAAIC,GAAd,CATH;;AAAA;AAAA,mCAUMC,CAVN;AAWC,kBAAMC,GAAG,GAAGT,KAAK,CACZU,MADO,CACA,kBADA,EACoB;AAAEC,gBAAAA,IAAI,EAAEH;AAAR,eADpB,EAEPI,IAFO,CAEF,UAAUC,GAAV,EAAe;AACjB,oBAAIA,GAAJ,EAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACTC,gBAAAA,OAAO,CAACC,GAAR,CAAYN,GAAG,CAACO,EAAhB;AACH,eALO,CAAZ;AAXD;;AAUH,iBAASR,CAAT,GAAa,CAAb,EAAgBA,CAAC,IAAI,GAArB,EAA0BA,CAAC,EAA3B,EAA+B;AAAA,oBAAtBA,CAAsB;AAO9B;;AAEDR,YAAAA,KAAK,CAACiB,OAAN,CAAc,kBAAd,EAAkC,EAAlC;AAAA,iFAAsC,kBAAgBR,GAAhB,EAAqBS,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACf,0BAAcT,GAAG,CAACU,IAAJ,CAASR,IAAvB,CADe;;AAAA;AAC5BS,wBAAAA,IAD4B;AAAA;AAAA,+BAETC,OAAO,CAACC,GAAR,CACrBF,IAAI,CAACG,GAAL;AAAA,8FAAS,iBAAOC,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACQ,8BAAkBA,KAAlB,CADR;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAT;;AAAA;AAAA;AAAA;AAAA,4BADqB,CAFS;;AAAA;AAE9BC,wBAAAA,YAF8B;AAOlCA,wBAAAA,YAAY,GAAGA,YAAY,CAACC,MAAb,CAAoB,UAACC,CAAD;AAAA,iCAAO,CAAC,CAACA,CAAT;AAAA,yBAApB,CAAf;AAPkC;AAAA,+BAQ5BC,cAAMlB,MAAN,CAAae,YAAb,CAR4B;;AAAA;AASlCP,wBAAAA,IAAI;;AAT8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAtC;;AAAA;AAAA;AAAA;AAAA;;AAnBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import { getListMovies, updateMovieDetail, getMovieSrc } from \"./movie\";\r\nimport Redis from \"ioredis\";\r\nimport kue from \"kue\";\r\n\r\nimport { dbConnect, env } from \"../configs\";\r\nimport { Movie } from \"../models\";\r\n\r\nexport async function crawlMovies() {\r\n    const queue = kue.createQueue({\r\n        redis: {\r\n            createClientFactory: function () {\r\n                return new Redis();\r\n            },\r\n        },\r\n    });\r\n\r\n    await dbConnect(env.uri);\r\n    for (let i = 1; i <= 270; i++) {\r\n        const job = queue\r\n            .create(\"crawl-list-movie\", { page: i })\r\n            .save(function (err) {\r\n                if (err) console.log(err);\r\n                console.log(job.id);\r\n            });\r\n    }\r\n\r\n    queue.process(\"crawl-list-movie\", 10, async function (job, done) {\r\n        const list = await getListMovies(job.data.page);\r\n        let list_updated = await Promise.all(\r\n            list.map(async (movie) => {\r\n                return await updateMovieDetail(movie);\r\n            }),\r\n        );\r\n        list_updated = list_updated.filter((e) => !!e);\r\n        await Movie.create(list_updated);\r\n        done();\r\n    });\r\n}\r\n\r\nexport { getMovieSrc };\r\n"],"file":"index.js"}